b152a1a79b88ad4a7fc374f7e28abe56
"use strict";
'use client';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = useCurrentColorScheme;
exports.getColorScheme = getColorScheme;
exports.getSystemMode = getSystemMode;
var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));
var React = _interopRequireWildcard(require("react"));
var _getInitColorSchemeScript = require("./getInitColorSchemeScript");
function _getRequireWildcardCache(nodeInterop) {
  if (typeof WeakMap !== "function") return null;
  var cacheBabelInterop = new WeakMap();
  var cacheNodeInterop = new WeakMap();
  return (_getRequireWildcardCache = function (nodeInterop) {
    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
  })(nodeInterop);
}
function _interopRequireWildcard(obj, nodeInterop) {
  if (!nodeInterop && obj && obj.__esModule) {
    return obj;
  }
  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }
  var cache = _getRequireWildcardCache(nodeInterop);
  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }
  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
  for (var key in obj) {
    if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }
  newObj.default = obj;
  if (cache) {
    cache.set(obj, newObj);
  }
  return newObj;
}
function getSystemMode(mode) {
  if (typeof window !== 'undefined' && mode === 'system') {
    const mql = window.matchMedia('(prefers-color-scheme: dark)');
    if (mql.matches) {
      return 'dark';
    }
    return 'light';
  }
  return undefined;
}
function processState(state, callback) {
  if (state.mode === 'light' || state.mode === 'system' && state.systemMode === 'light') {
    return callback('light');
  }
  if (state.mode === 'dark' || state.mode === 'system' && state.systemMode === 'dark') {
    return callback('dark');
  }
  return undefined;
}
function getColorScheme(state) {
  return processState(state, mode => {
    if (mode === 'light') {
      return state.lightColorScheme;
    }
    if (mode === 'dark') {
      return state.darkColorScheme;
    }
    return undefined;
  });
}
function initializeValue(key, defaultValue) {
  if (typeof window === 'undefined') {
    return undefined;
  }
  let value;
  try {
    value = localStorage.getItem(key) || undefined;
    if (!value) {
      // the first time that user enters the site.
      localStorage.setItem(key, defaultValue);
    }
  } catch (e) {
    // Unsupported
  }
  return value || defaultValue;
}
function useCurrentColorScheme(options) {
  const {
    defaultMode = 'light',
    defaultLightColorScheme,
    defaultDarkColorScheme,
    supportedColorSchemes = [],
    modeStorageKey = _getInitColorSchemeScript.DEFAULT_MODE_STORAGE_KEY,
    colorSchemeStorageKey = _getInitColorSchemeScript.DEFAULT_COLOR_SCHEME_STORAGE_KEY,
    storageWindow = typeof window === 'undefined' ? undefined : window
  } = options;
  const joinedColorSchemes = supportedColorSchemes.join(',');
  const [state, setState] = React.useState(() => {
    const initialMode = initializeValue(modeStorageKey, defaultMode);
    const lightColorScheme = initializeValue(`${colorSchemeStorageKey}-light`, defaultLightColorScheme);
    const darkColorScheme = initializeValue(`${colorSchemeStorageKey}-dark`, defaultDarkColorScheme);
    return {
      mode: initialMode,
      systemMode: getSystemMode(initialMode),
      lightColorScheme,
      darkColorScheme
    };
  });
  const colorScheme = getColorScheme(state);
  const setMode = React.useCallback(mode => {
    setState(currentState => {
      if (mode === currentState.mode) {
        // do nothing if mode does not change
        return currentState;
      }
      const newMode = !mode ? defaultMode : mode;
      try {
        localStorage.setItem(modeStorageKey, newMode);
      } catch (e) {
        // Unsupported
      }
      return (0, _extends2.default)({}, currentState, {
        mode: newMode,
        systemMode: getSystemMode(newMode)
      });
    });
  }, [modeStorageKey, defaultMode]);
  const setColorScheme = React.useCallback(value => {
    if (!value) {
      setState(currentState => {
        try {
          localStorage.setItem(`${colorSchemeStorageKey}-light`, defaultLightColorScheme);
          localStorage.setItem(`${colorSchemeStorageKey}-dark`, defaultDarkColorScheme);
        } catch (e) {
          // Unsupported
        }
        return (0, _extends2.default)({}, currentState, {
          lightColorScheme: defaultLightColorScheme,
          darkColorScheme: defaultDarkColorScheme
        });
      });
    } else if (typeof value === 'string') {
      if (value && !joinedColorSchemes.includes(value)) {
        console.error(`\`${value}\` does not exist in \`theme.colorSchemes\`.`);
      } else {
        setState(currentState => {
          const newState = (0, _extends2.default)({}, currentState);
          processState(currentState, mode => {
            try {
              localStorage.setItem(`${colorSchemeStorageKey}-${mode}`, value);
            } catch (e) {
              // Unsupported
            }
            if (mode === 'light') {
              newState.lightColorScheme = value;
            }
            if (mode === 'dark') {
              newState.darkColorScheme = value;
            }
          });
          return newState;
        });
      }
    } else {
      setState(currentState => {
        const newState = (0, _extends2.default)({}, currentState);
        const newLightColorScheme = value.light === null ? defaultLightColorScheme : value.light;
        const newDarkColorScheme = value.dark === null ? defaultDarkColorScheme : value.dark;
        if (newLightColorScheme) {
          if (!joinedColorSchemes.includes(newLightColorScheme)) {
            console.error(`\`${newLightColorScheme}\` does not exist in \`theme.colorSchemes\`.`);
          } else {
            newState.lightColorScheme = newLightColorScheme;
            try {
              localStorage.setItem(`${colorSchemeStorageKey}-light`, newLightColorScheme);
            } catch (error) {
              // Unsupported
            }
          }
        }
        if (newDarkColorScheme) {
          if (!joinedColorSchemes.includes(newDarkColorScheme)) {
            console.error(`\`${newDarkColorScheme}\` does not exist in \`theme.colorSchemes\`.`);
          } else {
            newState.darkColorScheme = newDarkColorScheme;
            try {
              localStorage.setItem(`${colorSchemeStorageKey}-dark`, newDarkColorScheme);
            } catch (error) {
              // Unsupported
            }
          }
        }
        return newState;
      });
    }
  }, [joinedColorSchemes, colorSchemeStorageKey, defaultLightColorScheme, defaultDarkColorScheme]);
  const handleMediaQuery = React.useCallback(e => {
    if (state.mode === 'system') {
      setState(currentState => (0, _extends2.default)({}, currentState, {
        systemMode: e != null && e.matches ? 'dark' : 'light'
      }));
    }
  }, [state.mode]);

  // Ref hack to avoid adding handleMediaQuery as a dep
  const mediaListener = React.useRef(handleMediaQuery);
  mediaListener.current = handleMediaQuery;
  React.useEffect(() => {
    const handler = (...args) => mediaListener.current(...args);

    // Always listen to System preference
    const media = window.matchMedia('(prefers-color-scheme: dark)');

    // Intentionally use deprecated listener methods to support iOS & old browsers
    media.addListener(handler);
    handler(media);
    return () => media.removeListener(handler);
  }, []);

  // Handle when localStorage has changed
  React.useEffect(() => {
    const handleStorage = event => {
      const value = event.newValue;
      if (typeof event.key === 'string' && event.key.startsWith(colorSchemeStorageKey) && (!value || joinedColorSchemes.match(value))) {
        // If the key is deleted, value will be null then reset color scheme to the default one.
        if (event.key.endsWith('light')) {
          setColorScheme({
            light: value
          });
        }
        if (event.key.endsWith('dark')) {
          setColorScheme({
            dark: value
          });
        }
      }
      if (event.key === modeStorageKey && (!value || ['light', 'dark', 'system'].includes(value))) {
        setMode(value || defaultMode);
      }
    };
    if (storageWindow) {
      // For syncing color-scheme changes between iframes
      storageWindow.addEventListener('storage', handleStorage);
      return () => storageWindow.removeEventListener('storage', handleStorage);
    }
    return undefined;
  }, [setColorScheme, setMode, modeStorageKey, colorSchemeStorageKey, joinedColorSchemes, defaultMode, storageWindow]);
  return (0, _extends2.default)({}, state, {
    colorScheme,
    setMode,
    setColorScheme
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiZGVmYXVsdCIsInVzZUN1cnJlbnRDb2xvclNjaGVtZSIsImdldENvbG9yU2NoZW1lIiwiZ2V0U3lzdGVtTW9kZSIsIl9leHRlbmRzMiIsIlJlYWN0IiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJfZ2V0SW5pdENvbG9yU2NoZW1lU2NyaXB0IiwiX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlIiwibm9kZUludGVyb3AiLCJXZWFrTWFwIiwiY2FjaGVCYWJlbEludGVyb3AiLCJjYWNoZU5vZGVJbnRlcm9wIiwib2JqIiwiX19lc01vZHVsZSIsImNhY2hlIiwiaGFzIiwiZ2V0IiwibmV3T2JqIiwiaGFzUHJvcGVydHlEZXNjcmlwdG9yIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwia2V5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiZGVzYyIsInNldCIsIm1vZGUiLCJ3aW5kb3ciLCJtcWwiLCJtYXRjaE1lZGlhIiwibWF0Y2hlcyIsInVuZGVmaW5lZCIsInByb2Nlc3NTdGF0ZSIsInN0YXRlIiwiY2FsbGJhY2siLCJzeXN0ZW1Nb2RlIiwibGlnaHRDb2xvclNjaGVtZSIsImRhcmtDb2xvclNjaGVtZSIsImluaXRpYWxpemVWYWx1ZSIsImRlZmF1bHRWYWx1ZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzZXRJdGVtIiwiZSIsIm9wdGlvbnMiLCJkZWZhdWx0TW9kZSIsImRlZmF1bHRMaWdodENvbG9yU2NoZW1lIiwiZGVmYXVsdERhcmtDb2xvclNjaGVtZSIsInN1cHBvcnRlZENvbG9yU2NoZW1lcyIsIm1vZGVTdG9yYWdlS2V5IiwiREVGQVVMVF9NT0RFX1NUT1JBR0VfS0VZIiwiY29sb3JTY2hlbWVTdG9yYWdlS2V5IiwiREVGQVVMVF9DT0xPUl9TQ0hFTUVfU1RPUkFHRV9LRVkiLCJzdG9yYWdlV2luZG93Iiwiam9pbmVkQ29sb3JTY2hlbWVzIiwiam9pbiIsInNldFN0YXRlIiwidXNlU3RhdGUiLCJpbml0aWFsTW9kZSIsImNvbG9yU2NoZW1lIiwic2V0TW9kZSIsInVzZUNhbGxiYWNrIiwiY3VycmVudFN0YXRlIiwibmV3TW9kZSIsInNldENvbG9yU2NoZW1lIiwiaW5jbHVkZXMiLCJjb25zb2xlIiwiZXJyb3IiLCJuZXdTdGF0ZSIsIm5ld0xpZ2h0Q29sb3JTY2hlbWUiLCJsaWdodCIsIm5ld0RhcmtDb2xvclNjaGVtZSIsImRhcmsiLCJoYW5kbGVNZWRpYVF1ZXJ5IiwibWVkaWFMaXN0ZW5lciIsInVzZVJlZiIsImN1cnJlbnQiLCJ1c2VFZmZlY3QiLCJoYW5kbGVyIiwiYXJncyIsIm1lZGlhIiwiYWRkTGlzdGVuZXIiLCJyZW1vdmVMaXN0ZW5lciIsImhhbmRsZVN0b3JhZ2UiLCJldmVudCIsIm5ld1ZhbHVlIiwic3RhcnRzV2l0aCIsIm1hdGNoIiwiZW5kc1dpdGgiLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciJdLCJzb3VyY2VzIjpbInVzZUN1cnJlbnRDb2xvclNjaGVtZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbid1c2UgY2xpZW50JztcblxudmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKFwiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9pbnRlcm9wUmVxdWlyZURlZmF1bHRcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5kZWZhdWx0ID0gdXNlQ3VycmVudENvbG9yU2NoZW1lO1xuZXhwb3J0cy5nZXRDb2xvclNjaGVtZSA9IGdldENvbG9yU2NoZW1lO1xuZXhwb3J0cy5nZXRTeXN0ZW1Nb2RlID0gZ2V0U3lzdGVtTW9kZTtcbnZhciBfZXh0ZW5kczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2V4dGVuZHNcIikpO1xudmFyIFJlYWN0ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZShcInJlYWN0XCIpKTtcbnZhciBfZ2V0SW5pdENvbG9yU2NoZW1lU2NyaXB0ID0gcmVxdWlyZShcIi4vZ2V0SW5pdENvbG9yU2NoZW1lU2NyaXB0XCIpO1xuZnVuY3Rpb24gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKG5vZGVJbnRlcm9wKSB7IGlmICh0eXBlb2YgV2Vha01hcCAhPT0gXCJmdW5jdGlvblwiKSByZXR1cm4gbnVsbDsgdmFyIGNhY2hlQmFiZWxJbnRlcm9wID0gbmV3IFdlYWtNYXAoKTsgdmFyIGNhY2hlTm9kZUludGVyb3AgPSBuZXcgV2Vha01hcCgpOyByZXR1cm4gKF9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSA9IGZ1bmN0aW9uIChub2RlSW50ZXJvcCkgeyByZXR1cm4gbm9kZUludGVyb3AgPyBjYWNoZU5vZGVJbnRlcm9wIDogY2FjaGVCYWJlbEludGVyb3A7IH0pKG5vZGVJbnRlcm9wKTsgfVxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqLCBub2RlSW50ZXJvcCkgeyBpZiAoIW5vZGVJbnRlcm9wICYmIG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGlmIChvYmogPT09IG51bGwgfHwgdHlwZW9mIG9iaiAhPT0gXCJvYmplY3RcIiAmJiB0eXBlb2Ygb2JqICE9PSBcImZ1bmN0aW9uXCIpIHsgcmV0dXJuIHsgZGVmYXVsdDogb2JqIH07IH0gdmFyIGNhY2hlID0gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKG5vZGVJbnRlcm9wKTsgaWYgKGNhY2hlICYmIGNhY2hlLmhhcyhvYmopKSB7IHJldHVybiBjYWNoZS5nZXQob2JqKTsgfSB2YXIgbmV3T2JqID0ge307IHZhciBoYXNQcm9wZXJ0eURlc2NyaXB0b3IgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsgZm9yICh2YXIga2V5IGluIG9iaikgeyBpZiAoa2V5ICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7IHZhciBkZXNjID0gaGFzUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiBudWxsOyBpZiAoZGVzYyAmJiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7IH0gZWxzZSB7IG5ld09ialtrZXldID0gb2JqW2tleV07IH0gfSB9IG5ld09iai5kZWZhdWx0ID0gb2JqOyBpZiAoY2FjaGUpIHsgY2FjaGUuc2V0KG9iaiwgbmV3T2JqKTsgfSByZXR1cm4gbmV3T2JqOyB9XG5mdW5jdGlvbiBnZXRTeXN0ZW1Nb2RlKG1vZGUpIHtcbiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIG1vZGUgPT09ICdzeXN0ZW0nKSB7XG4gICAgY29uc3QgbXFsID0gd2luZG93Lm1hdGNoTWVkaWEoJyhwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyayknKTtcbiAgICBpZiAobXFsLm1hdGNoZXMpIHtcbiAgICAgIHJldHVybiAnZGFyayc7XG4gICAgfVxuICAgIHJldHVybiAnbGlnaHQnO1xuICB9XG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5mdW5jdGlvbiBwcm9jZXNzU3RhdGUoc3RhdGUsIGNhbGxiYWNrKSB7XG4gIGlmIChzdGF0ZS5tb2RlID09PSAnbGlnaHQnIHx8IHN0YXRlLm1vZGUgPT09ICdzeXN0ZW0nICYmIHN0YXRlLnN5c3RlbU1vZGUgPT09ICdsaWdodCcpIHtcbiAgICByZXR1cm4gY2FsbGJhY2soJ2xpZ2h0Jyk7XG4gIH1cbiAgaWYgKHN0YXRlLm1vZGUgPT09ICdkYXJrJyB8fCBzdGF0ZS5tb2RlID09PSAnc3lzdGVtJyAmJiBzdGF0ZS5zeXN0ZW1Nb2RlID09PSAnZGFyaycpIHtcbiAgICByZXR1cm4gY2FsbGJhY2soJ2RhcmsnKTtcbiAgfVxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuZnVuY3Rpb24gZ2V0Q29sb3JTY2hlbWUoc3RhdGUpIHtcbiAgcmV0dXJuIHByb2Nlc3NTdGF0ZShzdGF0ZSwgbW9kZSA9PiB7XG4gICAgaWYgKG1vZGUgPT09ICdsaWdodCcpIHtcbiAgICAgIHJldHVybiBzdGF0ZS5saWdodENvbG9yU2NoZW1lO1xuICAgIH1cbiAgICBpZiAobW9kZSA9PT0gJ2RhcmsnKSB7XG4gICAgICByZXR1cm4gc3RhdGUuZGFya0NvbG9yU2NoZW1lO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9KTtcbn1cbmZ1bmN0aW9uIGluaXRpYWxpemVWYWx1ZShrZXksIGRlZmF1bHRWYWx1ZSkge1xuICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG4gIGxldCB2YWx1ZTtcbiAgdHJ5IHtcbiAgICB2YWx1ZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSkgfHwgdW5kZWZpbmVkO1xuICAgIGlmICghdmFsdWUpIHtcbiAgICAgIC8vIHRoZSBmaXJzdCB0aW1lIHRoYXQgdXNlciBlbnRlcnMgdGhlIHNpdGUuXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIGRlZmF1bHRWYWx1ZSk7XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gVW5zdXBwb3J0ZWRcbiAgfVxuICByZXR1cm4gdmFsdWUgfHwgZGVmYXVsdFZhbHVlO1xufVxuZnVuY3Rpb24gdXNlQ3VycmVudENvbG9yU2NoZW1lKG9wdGlvbnMpIHtcbiAgY29uc3Qge1xuICAgIGRlZmF1bHRNb2RlID0gJ2xpZ2h0JyxcbiAgICBkZWZhdWx0TGlnaHRDb2xvclNjaGVtZSxcbiAgICBkZWZhdWx0RGFya0NvbG9yU2NoZW1lLFxuICAgIHN1cHBvcnRlZENvbG9yU2NoZW1lcyA9IFtdLFxuICAgIG1vZGVTdG9yYWdlS2V5ID0gX2dldEluaXRDb2xvclNjaGVtZVNjcmlwdC5ERUZBVUxUX01PREVfU1RPUkFHRV9LRVksXG4gICAgY29sb3JTY2hlbWVTdG9yYWdlS2V5ID0gX2dldEluaXRDb2xvclNjaGVtZVNjcmlwdC5ERUZBVUxUX0NPTE9SX1NDSEVNRV9TVE9SQUdFX0tFWSxcbiAgICBzdG9yYWdlV2luZG93ID0gdHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWQgOiB3aW5kb3dcbiAgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IGpvaW5lZENvbG9yU2NoZW1lcyA9IHN1cHBvcnRlZENvbG9yU2NoZW1lcy5qb2luKCcsJyk7XG4gIGNvbnN0IFtzdGF0ZSwgc2V0U3RhdGVdID0gUmVhY3QudXNlU3RhdGUoKCkgPT4ge1xuICAgIGNvbnN0IGluaXRpYWxNb2RlID0gaW5pdGlhbGl6ZVZhbHVlKG1vZGVTdG9yYWdlS2V5LCBkZWZhdWx0TW9kZSk7XG4gICAgY29uc3QgbGlnaHRDb2xvclNjaGVtZSA9IGluaXRpYWxpemVWYWx1ZShgJHtjb2xvclNjaGVtZVN0b3JhZ2VLZXl9LWxpZ2h0YCwgZGVmYXVsdExpZ2h0Q29sb3JTY2hlbWUpO1xuICAgIGNvbnN0IGRhcmtDb2xvclNjaGVtZSA9IGluaXRpYWxpemVWYWx1ZShgJHtjb2xvclNjaGVtZVN0b3JhZ2VLZXl9LWRhcmtgLCBkZWZhdWx0RGFya0NvbG9yU2NoZW1lKTtcbiAgICByZXR1cm4ge1xuICAgICAgbW9kZTogaW5pdGlhbE1vZGUsXG4gICAgICBzeXN0ZW1Nb2RlOiBnZXRTeXN0ZW1Nb2RlKGluaXRpYWxNb2RlKSxcbiAgICAgIGxpZ2h0Q29sb3JTY2hlbWUsXG4gICAgICBkYXJrQ29sb3JTY2hlbWVcbiAgICB9O1xuICB9KTtcbiAgY29uc3QgY29sb3JTY2hlbWUgPSBnZXRDb2xvclNjaGVtZShzdGF0ZSk7XG4gIGNvbnN0IHNldE1vZGUgPSBSZWFjdC51c2VDYWxsYmFjayhtb2RlID0+IHtcbiAgICBzZXRTdGF0ZShjdXJyZW50U3RhdGUgPT4ge1xuICAgICAgaWYgKG1vZGUgPT09IGN1cnJlbnRTdGF0ZS5tb2RlKSB7XG4gICAgICAgIC8vIGRvIG5vdGhpbmcgaWYgbW9kZSBkb2VzIG5vdCBjaGFuZ2VcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRTdGF0ZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IG5ld01vZGUgPSAhbW9kZSA/IGRlZmF1bHRNb2RlIDogbW9kZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKG1vZGVTdG9yYWdlS2V5LCBuZXdNb2RlKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gVW5zdXBwb3J0ZWRcbiAgICAgIH1cbiAgICAgIHJldHVybiAoMCwgX2V4dGVuZHMyLmRlZmF1bHQpKHt9LCBjdXJyZW50U3RhdGUsIHtcbiAgICAgICAgbW9kZTogbmV3TW9kZSxcbiAgICAgICAgc3lzdGVtTW9kZTogZ2V0U3lzdGVtTW9kZShuZXdNb2RlKVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0sIFttb2RlU3RvcmFnZUtleSwgZGVmYXVsdE1vZGVdKTtcbiAgY29uc3Qgc2V0Q29sb3JTY2hlbWUgPSBSZWFjdC51c2VDYWxsYmFjayh2YWx1ZSA9PiB7XG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgc2V0U3RhdGUoY3VycmVudFN0YXRlID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgJHtjb2xvclNjaGVtZVN0b3JhZ2VLZXl9LWxpZ2h0YCwgZGVmYXVsdExpZ2h0Q29sb3JTY2hlbWUpO1xuICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGAke2NvbG9yU2NoZW1lU3RvcmFnZUtleX0tZGFya2AsIGRlZmF1bHREYXJrQ29sb3JTY2hlbWUpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgLy8gVW5zdXBwb3J0ZWRcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKDAsIF9leHRlbmRzMi5kZWZhdWx0KSh7fSwgY3VycmVudFN0YXRlLCB7XG4gICAgICAgICAgbGlnaHRDb2xvclNjaGVtZTogZGVmYXVsdExpZ2h0Q29sb3JTY2hlbWUsXG4gICAgICAgICAgZGFya0NvbG9yU2NoZW1lOiBkZWZhdWx0RGFya0NvbG9yU2NoZW1lXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICBpZiAodmFsdWUgJiYgIWpvaW5lZENvbG9yU2NoZW1lcy5pbmNsdWRlcyh2YWx1ZSkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgXFxgJHt2YWx1ZX1cXGAgZG9lcyBub3QgZXhpc3QgaW4gXFxgdGhlbWUuY29sb3JTY2hlbWVzXFxgLmApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2V0U3RhdGUoY3VycmVudFN0YXRlID0+IHtcbiAgICAgICAgICBjb25zdCBuZXdTdGF0ZSA9ICgwLCBfZXh0ZW5kczIuZGVmYXVsdCkoe30sIGN1cnJlbnRTdGF0ZSk7XG4gICAgICAgICAgcHJvY2Vzc1N0YXRlKGN1cnJlbnRTdGF0ZSwgbW9kZSA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgJHtjb2xvclNjaGVtZVN0b3JhZ2VLZXl9LSR7bW9kZX1gLCB2YWx1ZSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgIC8vIFVuc3VwcG9ydGVkXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobW9kZSA9PT0gJ2xpZ2h0Jykge1xuICAgICAgICAgICAgICBuZXdTdGF0ZS5saWdodENvbG9yU2NoZW1lID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobW9kZSA9PT0gJ2RhcmsnKSB7XG4gICAgICAgICAgICAgIG5ld1N0YXRlLmRhcmtDb2xvclNjaGVtZSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBuZXdTdGF0ZTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHNldFN0YXRlKGN1cnJlbnRTdGF0ZSA9PiB7XG4gICAgICAgIGNvbnN0IG5ld1N0YXRlID0gKDAsIF9leHRlbmRzMi5kZWZhdWx0KSh7fSwgY3VycmVudFN0YXRlKTtcbiAgICAgICAgY29uc3QgbmV3TGlnaHRDb2xvclNjaGVtZSA9IHZhbHVlLmxpZ2h0ID09PSBudWxsID8gZGVmYXVsdExpZ2h0Q29sb3JTY2hlbWUgOiB2YWx1ZS5saWdodDtcbiAgICAgICAgY29uc3QgbmV3RGFya0NvbG9yU2NoZW1lID0gdmFsdWUuZGFyayA9PT0gbnVsbCA/IGRlZmF1bHREYXJrQ29sb3JTY2hlbWUgOiB2YWx1ZS5kYXJrO1xuICAgICAgICBpZiAobmV3TGlnaHRDb2xvclNjaGVtZSkge1xuICAgICAgICAgIGlmICgham9pbmVkQ29sb3JTY2hlbWVzLmluY2x1ZGVzKG5ld0xpZ2h0Q29sb3JTY2hlbWUpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBcXGAke25ld0xpZ2h0Q29sb3JTY2hlbWV9XFxgIGRvZXMgbm90IGV4aXN0IGluIFxcYHRoZW1lLmNvbG9yU2NoZW1lc1xcYC5gKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV3U3RhdGUubGlnaHRDb2xvclNjaGVtZSA9IG5ld0xpZ2h0Q29sb3JTY2hlbWU7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgJHtjb2xvclNjaGVtZVN0b3JhZ2VLZXl9LWxpZ2h0YCwgbmV3TGlnaHRDb2xvclNjaGVtZSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAvLyBVbnN1cHBvcnRlZFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobmV3RGFya0NvbG9yU2NoZW1lKSB7XG4gICAgICAgICAgaWYgKCFqb2luZWRDb2xvclNjaGVtZXMuaW5jbHVkZXMobmV3RGFya0NvbG9yU2NoZW1lKSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgXFxgJHtuZXdEYXJrQ29sb3JTY2hlbWV9XFxgIGRvZXMgbm90IGV4aXN0IGluIFxcYHRoZW1lLmNvbG9yU2NoZW1lc1xcYC5gKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV3U3RhdGUuZGFya0NvbG9yU2NoZW1lID0gbmV3RGFya0NvbG9yU2NoZW1lO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYCR7Y29sb3JTY2hlbWVTdG9yYWdlS2V5fS1kYXJrYCwgbmV3RGFya0NvbG9yU2NoZW1lKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgIC8vIFVuc3VwcG9ydGVkXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXdTdGF0ZTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwgW2pvaW5lZENvbG9yU2NoZW1lcywgY29sb3JTY2hlbWVTdG9yYWdlS2V5LCBkZWZhdWx0TGlnaHRDb2xvclNjaGVtZSwgZGVmYXVsdERhcmtDb2xvclNjaGVtZV0pO1xuICBjb25zdCBoYW5kbGVNZWRpYVF1ZXJ5ID0gUmVhY3QudXNlQ2FsbGJhY2soZSA9PiB7XG4gICAgaWYgKHN0YXRlLm1vZGUgPT09ICdzeXN0ZW0nKSB7XG4gICAgICBzZXRTdGF0ZShjdXJyZW50U3RhdGUgPT4gKDAsIF9leHRlbmRzMi5kZWZhdWx0KSh7fSwgY3VycmVudFN0YXRlLCB7XG4gICAgICAgIHN5c3RlbU1vZGU6IGUgIT0gbnVsbCAmJiBlLm1hdGNoZXMgPyAnZGFyaycgOiAnbGlnaHQnXG4gICAgICB9KSk7XG4gICAgfVxuICB9LCBbc3RhdGUubW9kZV0pO1xuXG4gIC8vIFJlZiBoYWNrIHRvIGF2b2lkIGFkZGluZyBoYW5kbGVNZWRpYVF1ZXJ5IGFzIGEgZGVwXG4gIGNvbnN0IG1lZGlhTGlzdGVuZXIgPSBSZWFjdC51c2VSZWYoaGFuZGxlTWVkaWFRdWVyeSk7XG4gIG1lZGlhTGlzdGVuZXIuY3VycmVudCA9IGhhbmRsZU1lZGlhUXVlcnk7XG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgaGFuZGxlciA9ICguLi5hcmdzKSA9PiBtZWRpYUxpc3RlbmVyLmN1cnJlbnQoLi4uYXJncyk7XG5cbiAgICAvLyBBbHdheXMgbGlzdGVuIHRvIFN5c3RlbSBwcmVmZXJlbmNlXG4gICAgY29uc3QgbWVkaWEgPSB3aW5kb3cubWF0Y2hNZWRpYSgnKHByZWZlcnMtY29sb3Itc2NoZW1lOiBkYXJrKScpO1xuXG4gICAgLy8gSW50ZW50aW9uYWxseSB1c2UgZGVwcmVjYXRlZCBsaXN0ZW5lciBtZXRob2RzIHRvIHN1cHBvcnQgaU9TICYgb2xkIGJyb3dzZXJzXG4gICAgbWVkaWEuYWRkTGlzdGVuZXIoaGFuZGxlcik7XG4gICAgaGFuZGxlcihtZWRpYSk7XG4gICAgcmV0dXJuICgpID0+IG1lZGlhLnJlbW92ZUxpc3RlbmVyKGhhbmRsZXIpO1xuICB9LCBbXSk7XG5cbiAgLy8gSGFuZGxlIHdoZW4gbG9jYWxTdG9yYWdlIGhhcyBjaGFuZ2VkXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgaGFuZGxlU3RvcmFnZSA9IGV2ZW50ID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gZXZlbnQubmV3VmFsdWU7XG4gICAgICBpZiAodHlwZW9mIGV2ZW50LmtleSA9PT0gJ3N0cmluZycgJiYgZXZlbnQua2V5LnN0YXJ0c1dpdGgoY29sb3JTY2hlbWVTdG9yYWdlS2V5KSAmJiAoIXZhbHVlIHx8IGpvaW5lZENvbG9yU2NoZW1lcy5tYXRjaCh2YWx1ZSkpKSB7XG4gICAgICAgIC8vIElmIHRoZSBrZXkgaXMgZGVsZXRlZCwgdmFsdWUgd2lsbCBiZSBudWxsIHRoZW4gcmVzZXQgY29sb3Igc2NoZW1lIHRvIHRoZSBkZWZhdWx0IG9uZS5cbiAgICAgICAgaWYgKGV2ZW50LmtleS5lbmRzV2l0aCgnbGlnaHQnKSkge1xuICAgICAgICAgIHNldENvbG9yU2NoZW1lKHtcbiAgICAgICAgICAgIGxpZ2h0OiB2YWx1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChldmVudC5rZXkuZW5kc1dpdGgoJ2RhcmsnKSkge1xuICAgICAgICAgIHNldENvbG9yU2NoZW1lKHtcbiAgICAgICAgICAgIGRhcms6IHZhbHVlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChldmVudC5rZXkgPT09IG1vZGVTdG9yYWdlS2V5ICYmICghdmFsdWUgfHwgWydsaWdodCcsICdkYXJrJywgJ3N5c3RlbSddLmluY2x1ZGVzKHZhbHVlKSkpIHtcbiAgICAgICAgc2V0TW9kZSh2YWx1ZSB8fCBkZWZhdWx0TW9kZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBpZiAoc3RvcmFnZVdpbmRvdykge1xuICAgICAgLy8gRm9yIHN5bmNpbmcgY29sb3Itc2NoZW1lIGNoYW5nZXMgYmV0d2VlbiBpZnJhbWVzXG4gICAgICBzdG9yYWdlV2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3N0b3JhZ2UnLCBoYW5kbGVTdG9yYWdlKTtcbiAgICAgIHJldHVybiAoKSA9PiBzdG9yYWdlV2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3N0b3JhZ2UnLCBoYW5kbGVTdG9yYWdlKTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfSwgW3NldENvbG9yU2NoZW1lLCBzZXRNb2RlLCBtb2RlU3RvcmFnZUtleSwgY29sb3JTY2hlbWVTdG9yYWdlS2V5LCBqb2luZWRDb2xvclNjaGVtZXMsIGRlZmF1bHRNb2RlLCBzdG9yYWdlV2luZG93XSk7XG4gIHJldHVybiAoMCwgX2V4dGVuZHMyLmRlZmF1bHQpKHt9LCBzdGF0ZSwge1xuICAgIGNvbG9yU2NoZW1lLFxu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